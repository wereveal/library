<?php
/**
 *  Autoloader for framework.
 *  Based on the auto_load_real.php file generated by Composer
 *  @file WerAutoloader.php
 *  @class WerAutoloader
 *  @requires Composer\Autoload\ClassLoader
 *      which is installed on level out from the web site root
 *      in the vendor directory.
 *  @requires APP_PATH defined
 *  @requires VENDOR_PATH defined
 *  @author William Reveal  <wer@revealitconsulting.com>
 *  @version 1.0.0
 *  @par Change Log
 *      v1.0.0 - officially added to Framework
 *  @par Wer Framework version 4.0
 *  @date 2013-06-26 10:00:13
 *  @ingroup wer_framework core library
**/
namespace Wer\Framework\Library;

class WerAutoloader
{
    private static $loader;
    public static function loadClassLoader($class)
    {
        if ('Composer\Autoload\ClassLoader' === $class) {
            require VENDOR_PATH . '/composer/ClassLoader.php';
        }
    }

    public static function getLoader()
    {
        if (null !== self::$loader) {
            return self::$loader;
        }
        spl_autoload_register(array('Wer\Framework\Library\WerAutoloader', 'loadClassLoader'), true, true);
        self::$loader = $loader = new \Composer\Autoload\ClassLoader();
        spl_autoload_unregister(array('Wer\Framework\Library\WerAutoloader', 'loadClassLoader'));

        if (file_exists(APP_PATH . '/config/autoload_namespaces.php')) {
            $namespaces = require APP_PATH . '/config/autoload_namespaces.php';
            foreach ($namespaces as $namespace => $path) {
                $loader->add($namespace, $path);
            }
        }

        if (file_exists(APP_PATH . '/config/autoload_classmap.php')) {
            $classMap = require APP_PATH . '/config/autoload_classmap.php';
            if ($classMap) {
                $loader->addClassMap($classMap);
            }
        }

        if (file_exists(VENDOR_PATH . '/composer/autoload_namespaces.php')) {
            $namespaces = require VENDOR_PATH . '/composer/autoload_namespaces.php';
            foreach ($namespaces as $namespace => $path) {
                $loader->add($namespace, $path);
            }
        }

        if (file_exists(VENDOR_PATH . '/composer/autoload_classmap.php')) {
            $classMap = require VENDOR_PATH . '/composer/autoload_classmap.php';
            if ($classMap) {
                $loader->addClassMap($classMap);
            }
        }

        $loader->register(true);
        return $loader;
    }
}
